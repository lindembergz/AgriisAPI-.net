<div class="card">
      <!-- Toolbar -->
      <p-toolbar styleClass="mb-4">
        <ng-template pTemplate="left">
          <h2 class="m-0">Fornecedores</h2>
        </ng-template>
        <ng-template pTemplate="right">
          <p-button 
            label="Novo" 
            icon="pi pi-plus" 
            styleClass="p-button-success mr-2"
            routerLink="Novo Fornecedor"
          ></p-button>
        </ng-template>
      </p-toolbar>

      <!-- Filters -->
      <div class="grid mb-3">
        <div class="col-12 md:col-4">
          <span class="p-input-icon-left w-full">
           <!-- <i class="pi pi-search"></i>-->
            <input 
              pInputText 
              type="text" 
              placeholder="Buscar por nome ou CPF/CNPJ"
              class="w-full"
              [(ngModel)]="searchTerm"
              (input)="onSearchChange($event)"
            />
          </span>
        </div>
 <!-- 
        <div class="col-12 md:col-4">
          <p-select
            [options]="tipoClienteOptions"
            [(ngModel)]="selectedTipoCliente"
            (onChange)="onFilterChange()"
            placeholder="Tipo Cliente"
            optionLabel="label"
            optionValue="value"
            [showClear]="true"
            class="w-full">
          </p-select>
        </div>

      <div class="col-12 md:col-2">
          <p-select
            [options]="availableUfs()"
            [(ngModel)]="selectedUf"
            (onChange)="onUfFilterChange($event)"
            placeholder="UF"
            optionLabel="nome"
            optionValue="id"
            [showClear]="true"
            [loading]="ufsLoading()"
            class="w-full">
            <ng-template pTemplate="selectedItem" let-selectedOption>
              <span *ngIf="selectedOption">{{ getUfDisplayName(selectedOption) }}</span>
            </ng-template>
            <ng-template pTemplate="item" let-uf>
              <span>{{ uf.nome }} ({{ uf.codigo }})</span>
            </ng-template>
          </p-select>
        </div>

        <div class="col-12 md:col-2">
          <p-select
            [options]="availableMunicipios()"
            [(ngModel)]="selectedMunicipio"
            (onChange)="onMunicipioFilterChange($event)"
            placeholder="Município"
            optionLabel="nome"
            optionValue="id"
            [showClear]="true"
            [loading]="municipiosLoading()"
            [disabled]="!selectedUf"
            class="w-full">
          </p-select>
        </div>

        <div class="col-12 md:col-2">
          <p-button 
            label="Limpar Filtros" 
            icon="pi pi-filter-slash" 
            severity="secondary"
            [outlined]="true"
            (onClick)="clearFilters()"
            class="w-full">
          </p-button>
        </div>-->
      </div>

      <!-- Data Table -->
      <p-table 
        [value]="fornecedores()" 
        [columns]="columns"
        [loading]="isLoading()"
        [paginator]="true"
        [rows]="pageSize"
        [totalRecords]="totalRecords()"
        [lazy]="true"
        (onLazyLoad)="loadFornecedores($event)"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} registros"
        [rowsPerPageOptions]="[10, 25, 50]"
        styleClass="p-datatable-gridlines"
        [tableStyle]="{ 'min-width': '50rem' }"
        [globalFilterFields]="['nome', 'cpfCnpj', 'codigo', 'endereco.municipioNome', 'endereco.ufNome', 'endereco.cidade', 'endereco.uf']"
      >
        <ng-template pTemplate="header">
          <tr>
            <th *ngFor="let col of columns" [pSortableColumn]="col.sortable ? col.field : undefined" [style.width]="col.width">
              {{ col.header }}
              <p-sortIcon *ngIf="col.sortable" [field]="col.field"></p-sortIcon>
            </th>
            <th style="width: 120px">Ações</th>
          </tr>
        </ng-template>
        
        <ng-template pTemplate="body" let-fornecedor>
          <tr>
            <td>{{ fornecedor.id }}</td>
            <td>{{ fornecedor.nome }}</td>
            <td>{{fornecedor.cnpjFormatado }}</td>
            <td>
              <p-tag 
                [value]="getTipoClienteLabel(fornecedor.tipoCliente)"
                [severity]="getTipoClienteSeverity(fornecedor.tipoCliente)"
              ></p-tag>
            </td>
            <td>{{ getCompleteGeographicInfo(fornecedor) }}</td>
            <td>{{ getUf(fornecedor) }}</td>
            <td>
              <div class="flex gap-2">
                
                <p-button 
                  icon="pi pi-pencil" 
                   class="p-button-rounded p-button-text p-button-info edit-btn"
                  pTooltip="Editar"
                  (onClick)="navigateToEdit(fornecedor.id)"
                ></p-button>
                <p-button 
                  icon="pi pi-trash" 
                  class="p-button-rounded p-button-text p-button-danger delete-btn"
                  pTooltip="Excluir"
                  (onClick)="confirmDelete(fornecedor)"
                ></p-button>
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td [attr.colspan]="columns.length + 1" class="text-center">
              <div class="flex flex-column align-items-center justify-content-center py-5">
                <i class="pi pi-users" style="font-size: 3rem; color: var(--text-color-secondary);"></i>
                <p class="mt-3 mb-0" style="color: var(--text-color-secondary);">
                  {{ searchTerm || selectedTipoCliente || selectedUf || selectedMunicipio ? 'Nenhum fornecedor encontrado com os filtros aplicados' : 'Nenhum fornecedor cadastrado' }}
                </p>
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="loadingbody">
          <tr>
            <td [attr.colspan]="columns.length + 1" class="text-center">
              <div class="flex align-items-center justify-content-center py-5">
                <p-progressSpinner [style]="{ width: '50px', height: '50px' }"></p-progressSpinner>
                <span class="ml-3">Carregando fornecedores...</span>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>

    <p-confirmDialog></p-confirmDialog>