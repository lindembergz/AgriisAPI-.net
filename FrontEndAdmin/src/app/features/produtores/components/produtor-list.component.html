<div class="card">
      <!-- Toolbar -->
      <p-toolbar styleClass="mb-4">
        <ng-template pTemplate="left">
          <h2 class="m-0">Produtores</h2>
        </ng-template>
        <ng-template pTemplate="right">
          <p-button 
            label="Novo Produtor" 
            icon="pi pi-plus" 
            styleClass="p-button-success mr-2"
            (onClick)="navigateToNew()"
          ></p-button>
        </ng-template>
      </p-toolbar>

      <!-- Filters -->
      <div class="grid mb-3">
        <div class="col-12 md:col-4">
          <span class="p-input-icon-left w-full">
            <i class="pi pi-search"></i>
            <input 
              pInputText 
              type="text" 
              placeholder="Buscar por nome ou CPF/CNPJ"
              class="w-full"
              [(ngModel)]="searchTerm"
              (input)="onSearchChange($event)"
            />
          </span>
        </div>
      </div>

      <!-- Data Table -->
      <p-table 
        [value]="produtores()" 
        [columns]="columns"
        [loading]="isLoading()"
        [paginator]="true"
        [rows]="pageSize"
        [totalRecords]="totalRecords()"
        [lazy]="true"
        (onLazyLoad)="loadProdutores($event)"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} registros"
        [rowsPerPageOptions]="[10, 25, 50]"
        styleClass="p-datatable-gridlines"
        [tableStyle]="{ 'min-width': '50rem' }"
        [globalFilterFields]="['nome', 'cpfCnpj', 'codigo']"
      >
        <ng-template pTemplate="header">
          <tr>
            <th *ngFor="let col of columns" [pSortableColumn]="col.sortable ? col.field : undefined" [style.width]="col.width">
              {{ col.header }}
              <p-sortIcon *ngIf="col.sortable" [field]="col.field"></p-sortIcon>
            </th>
            <th style="width: 120px">Ações</th>
          </tr>
        </ng-template>
        
        <ng-template pTemplate="body" let-produtor>
          <tr>
            <td>{{ produtor.id }}</td>
            <td>{{ produtor.nome }}</td>
            <td>{{produtor.cpfFormatado }}</td>
            <td>
              <p-tag 
                [value]="getTipoClienteLabel(produtor.tipoCliente)"
                [severity]="getTipoClienteSeverity(produtor.tipoCliente)"
              ></p-tag>
            </td>
            <td>{{ getLocalidade(produtor) }}</td>
            <td>{{ getUf(produtor) }}</td>
            <td>
              <div class="flex gap-2">
                <p-button 
                  icon="pi pi-pencil" 
                   class="p-button-rounded p-button-text p-button-info edit-btn"
                  pTooltip="Editar"
                  (onClick)="navigateToEdit(produtor.id)"
                ></p-button>
                <p-button 
                  icon="pi pi-trash" 
                  class="p-button-rounded p-button-text p-button-danger delete-btn"
                  pTooltip="Excluir"
                  (onClick)="confirmDelete(produtor)"
                ></p-button>
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td [attr.colspan]="columns.length + 1" class="text-center">
              <div class="flex flex-column align-items-center justify-content-center py-5">
                <i class="pi pi-users" style="font-size: 3rem; color: var(--text-color-secondary);"></i>
                <p class="mt-3 mb-0" style="color: var(--text-color-secondary);">
                  {{ searchTerm || selectedTipoCliente || selectedUf ? 'Nenhum produtor encontrado com os filtros aplicados' : 'Nenhum produtor cadastrado' }}
                </p>
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="loadingbody">
          <tr>
            <td [attr.colspan]="columns.length + 1" class="text-center">
              <div class="flex align-items-center justify-content-center py-5">
                <p-progressSpinner [style]="{ width: '50px', height: '50px' }"></p-progressSpinner>
                <span class="ml-3">Carregando produtores...</span>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>

    <p-confirmDialog></p-confirmDialog>