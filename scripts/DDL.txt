-- public."AtividadesAgropecuarias" definição

-- Drop table

-- DROP TABLE public."AtividadesAgropecuarias";

CREATE TABLE public."AtividadesAgropecuarias" (
	"Id" serial4 NOT NULL,
	"Codigo" varchar(20) NOT NULL,
	"Descricao" varchar(200) NOT NULL,
	"Tipo" varchar(50) NOT NULL,
	"Ativo" bool DEFAULT true NOT NULL,
	"DataCriacao" timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamptz NULL,
	CONSTRAINT "AtividadesAgropecuarias_pkey" PRIMARY KEY ("Id")
);
CREATE UNIQUE INDEX "IX_AtividadesAgropecuarias_Codigo_Unique" ON public."AtividadesAgropecuarias" USING btree ("Codigo");
CREATE INDEX "IX_AtividadesAgropecuarias_DataCriacao" ON public."AtividadesAgropecuarias" USING btree ("DataCriacao");
CREATE INDEX "IX_AtividadesAgropecuarias_Descricao" ON public."AtividadesAgropecuarias" USING btree ("Descricao");
CREATE INDEX "IX_AtividadesAgropecuarias_Tipo" ON public."AtividadesAgropecuarias" USING btree ("Tipo");


-- public."Catalogo" definição

-- Drop table

-- DROP TABLE public."Catalogo";

CREATE TABLE public."Catalogo" (
	"Id" int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"SafraId" int4 NOT NULL,
	"PontoDistribuicaoId" int4 NOT NULL,
	"CulturaId" int4 NOT NULL,
	"CategoriaId" int4 NOT NULL,
	"Moeda" text NOT NULL,
	"DataInicio" timestamp NOT NULL,
	"DataFim" timestamp NULL,
	"Ativo" bool DEFAULT true NOT NULL,
	"DataCriacao" timestamp DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamp NULL,
	CONSTRAINT "PK_Catalogo" PRIMARY KEY ("Id")
);
CREATE INDEX "IX_Catalogo_CategoriaId" ON public."Catalogo" USING btree ("CategoriaId");
CREATE UNIQUE INDEX "IX_Catalogo_ChaveUnica" ON public."Catalogo" USING btree ("SafraId", "PontoDistribuicaoId", "CulturaId", "CategoriaId");
CREATE INDEX "IX_Catalogo_CulturaId" ON public."Catalogo" USING btree ("CulturaId");
CREATE INDEX "IX_Catalogo_PontoDistribuicaoId" ON public."Catalogo" USING btree ("PontoDistribuicaoId");
CREATE INDEX "IX_Catalogo_SafraId" ON public."Catalogo" USING btree ("SafraId");
CREATE INDEX "IX_Catalogo_Vigencia" ON public."Catalogo" USING btree ("DataInicio", "DataFim", "Ativo");
CREATE INDEX "IX_Catalogos_DataCriacao" ON public."Catalogo" USING btree ("DataCriacao");


-- public."Combo" definição

-- Drop table

-- DROP TABLE public."Combo";

CREATE TABLE public."Combo" (
	"Id" int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"Nome" varchar(200) NOT NULL,
	"Descricao" varchar(1000) NULL,
	"HectareMinimo" numeric(18, 4) NOT NULL,
	"HectareMaximo" numeric(18, 4) NOT NULL,
	"DataInicio" timestamptz NOT NULL,
	"DataFim" timestamptz NOT NULL,
	"ModalidadePagamento" int4 NOT NULL,
	"Status" int4 NOT NULL,
	"RestricoesMunicipios" jsonb NULL,
	"PermiteAlteracaoItem" bool NOT NULL,
	"PermiteExclusaoItem" bool NOT NULL,
	"FornecedorId" int4 NOT NULL,
	"SafraId" int4 NOT NULL,
	"DataCriacao" timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamptz NULL,
	CONSTRAINT "PK_Combo" PRIMARY KEY ("Id")
);
CREATE INDEX "IX_Combo_FornecedorId" ON public."Combo" USING btree ("FornecedorId");
CREATE UNIQUE INDEX "IX_Combo_FornecedorSafraNome" ON public."Combo" USING btree ("FornecedorId", "SafraId", "Nome");
CREATE INDEX "IX_Combo_Periodo" ON public."Combo" USING btree ("DataInicio", "DataFim");
CREATE INDEX "IX_Combo_SafraId" ON public."Combo" USING btree ("SafraId");
CREATE INDEX "IX_Combo_Status" ON public."Combo" USING btree ("Status");
CREATE INDEX "IX_Combos_DataCriacao" ON public."Combo" USING btree ("DataCriacao");


-- public."Cultura" definição

-- Drop table

-- DROP TABLE public."Cultura";

CREATE TABLE public."Cultura" (
	"Id" int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"Nome" varchar(100) NOT NULL,
	"Descricao" varchar(500) NULL,
	"Ativo" bool DEFAULT true NOT NULL,
	"DataCriacao" timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamptz NULL,
	CONSTRAINT "PK_Cultura" PRIMARY KEY ("Id")
);
CREATE INDEX "IX_Cultura_Ativo" ON public."Cultura" USING btree ("Ativo");
CREATE UNIQUE INDEX "IX_Cultura_Nome" ON public."Cultura" USING btree ("Nome");
CREATE INDEX "IX_Culturas_DataCriacao" ON public."Cultura" USING btree ("DataCriacao");


-- public."Moedas" definição

-- Drop table

-- DROP TABLE public."Moedas";

CREATE TABLE public."Moedas" (
	"Id" serial4 NOT NULL,
	"Codigo" varchar(3) NOT NULL,
	"Nome" varchar(100) NOT NULL,
	"Simbolo" varchar(5) NOT NULL,
	"Ativo" bool DEFAULT true NOT NULL,
	"DataCriacao" timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamptz NULL,
	CONSTRAINT "Moedas_pkey" PRIMARY KEY ("Id")
);
CREATE UNIQUE INDEX "IX_Moedas_Codigo_Unique" ON public."Moedas" USING btree ("Codigo");
CREATE INDEX "IX_Moedas_DataCriacao" ON public."Moedas" USING btree ("DataCriacao");
CREATE UNIQUE INDEX "IX_Moedas_Nome_Unique" ON public."Moedas" USING btree ("Nome");
CREATE UNIQUE INDEX "IX_Moedas_Simbolo_Unique" ON public."Moedas" USING btree ("Simbolo");


-- public."Pedido" definição

-- Drop table

-- DROP TABLE public."Pedido";

CREATE TABLE public."Pedido" (
	"Id" int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"Status" int4 NOT NULL,
	"StatusCarrinho" int4 NOT NULL,
	"QuantidadeItens" int4 NOT NULL,
	"Totais" jsonb NULL,
	"PermiteContato" bool NOT NULL,
	"NegociarPedido" bool NOT NULL,
	"DataLimiteInteracao" timestamptz NOT NULL,
	"FornecedorId" int4 NOT NULL,
	"ProdutorId" int4 NOT NULL,
	"DataCriacao" timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamptz NULL,
	CONSTRAINT "PK_Pedido" PRIMARY KEY ("Id")
);
CREATE INDEX "IX_Pedido_DataLimiteInteracao" ON public."Pedido" USING btree ("DataLimiteInteracao");
CREATE INDEX "IX_Pedido_FornecedorId" ON public."Pedido" USING btree ("FornecedorId");
CREATE INDEX "IX_Pedido_ProdutorId" ON public."Pedido" USING btree ("ProdutorId");
CREATE INDEX "IX_Pedido_ProdutorId_FornecedorId" ON public."Pedido" USING btree ("ProdutorId", "FornecedorId");
CREATE INDEX "IX_Pedido_Status" ON public."Pedido" USING btree ("Status");
CREATE INDEX "IX_Pedidos_DataCriacao" ON public."Pedido" USING btree ("DataCriacao");


-- public."Propriedade" definição

-- Drop table

-- DROP TABLE public."Propriedade";

CREATE TABLE public."Propriedade" (
	"Id" int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"Nome" varchar(200) NOT NULL,
	"Nirf" varchar(50) NULL,
	"InscricaoEstadual" varchar(50) NULL,
	"AreaTotal" numeric(18, 4) NOT NULL,
	"ProdutorId" int4 NOT NULL,
	"EnderecoId" int4 NULL,
	"DadosAdicionais" jsonb NULL,
	"DataCriacao" timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamptz NULL,
	CONSTRAINT "PK_Propriedade" PRIMARY KEY ("Id")
);
CREATE INDEX "IX_Propriedade_EnderecoId" ON public."Propriedade" USING btree ("EnderecoId");
CREATE INDEX "IX_Propriedade_Nome" ON public."Propriedade" USING btree ("Nome");
CREATE INDEX "IX_Propriedade_ProdutorId" ON public."Propriedade" USING btree ("ProdutorId");
CREATE INDEX "IX_Propriedades_DataCriacao" ON public."Propriedade" USING btree ("DataCriacao");


-- public."Safra" definição

-- Drop table

-- DROP TABLE public."Safra";

CREATE TABLE public."Safra" (
	"Id" int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"PlantioInicial" date NOT NULL,
	"PlantioFinal" date NOT NULL,
	"PlantioNome" varchar(256) NOT NULL,
	"Descricao" varchar(64) NOT NULL,
	"AnoColheita" int4 NOT NULL,
	"DataCriacao" timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamptz NULL,
	CONSTRAINT "PK_Safra" PRIMARY KEY ("Id")
);
CREATE INDEX "IX_Safra_AnoColheita" ON public."Safra" USING btree ("AnoColheita");
CREATE INDEX "IX_Safra_PlantioFinal" ON public."Safra" USING btree ("PlantioFinal");
CREATE INDEX "IX_Safra_PlantioInicial" ON public."Safra" USING btree ("PlantioInicial");
CREATE INDEX "IX_Safras_DataCriacao" ON public."Safra" USING btree ("DataCriacao");


-- public."UnidadesMedida" definição

-- Drop table

-- DROP TABLE public."UnidadesMedida";

CREATE TABLE public."UnidadesMedida" (
	"Id" serial4 NOT NULL,
	"Simbolo" varchar(10) NOT NULL,
	"Nome" varchar(100) NOT NULL,
	"Tipo" varchar(50) NOT NULL,
	"FatorConversao" numeric(18, 6) NULL,
	"Ativo" bool DEFAULT true NOT NULL,
	"DataCriacao" timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamptz NULL,
	CONSTRAINT "UnidadesMedida_pkey" PRIMARY KEY ("Id")
);
CREATE INDEX "IX_UnidadesMedida_DataCriacao" ON public."UnidadesMedida" USING btree ("DataCriacao");
CREATE INDEX "IX_UnidadesMedida_Nome" ON public."UnidadesMedida" USING btree ("Nome");
CREATE UNIQUE INDEX "IX_UnidadesMedida_Simbolo_Unique" ON public."UnidadesMedida" USING btree ("Simbolo");
CREATE INDEX "IX_UnidadesMedida_Tipo" ON public."UnidadesMedida" USING btree ("Tipo");


-- public."__EFMigrationsHistory" definição

-- Drop table

-- DROP TABLE public."__EFMigrationsHistory";

CREATE TABLE public."__EFMigrationsHistory" (
	"MigrationId" varchar(150) NOT NULL,
	"ProductVersion" varchar(32) NOT NULL,
	CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
);


-- public.estados definição

-- Drop table

-- DROP TABLE public.estados;

CREATE TABLE public.estados (
	id int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	nome varchar(100) NOT NULL,
	uf varchar(2) NOT NULL,
	codigo_ibge int4 NOT NULL,
	regiao varchar(50) NOT NULL,
	data_criacao timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	data_atualizacao timestamptz NULL,
	CONSTRAINT "PK_estados" PRIMARY KEY (id)
);
CREATE INDEX "IX_Estados_DataCriacao" ON public.estados USING btree (data_criacao);
CREATE UNIQUE INDEX "IX_estados_codigo_ibge" ON public.estados USING btree (codigo_ibge);
CREATE INDEX "IX_estados_nome" ON public.estados USING btree (nome);
CREATE INDEX "IX_estados_regiao" ON public.estados USING btree (regiao);
CREATE UNIQUE INDEX "IX_estados_uf" ON public.estados USING btree (uf);


-- public.forma_pagamento definição

-- Drop table

-- DROP TABLE public.forma_pagamento;

CREATE TABLE public.forma_pagamento (
	id int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	descricao varchar(45) NOT NULL,
	ativo bool DEFAULT true NOT NULL,
	data_criacao timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	data_atualizacao timestamptz NULL,
	CONSTRAINT "PK_forma_pagamento" PRIMARY KEY (id)
);
CREATE INDEX "IX_FormasPagamento_DataCriacao" ON public.forma_pagamento USING btree (data_criacao);
CREATE INDEX ix_forma_pagamento_ativo ON public.forma_pagamento USING btree (ativo);
CREATE INDEX ix_forma_pagamento_descricao ON public.forma_pagamento USING btree (descricao);


-- public.refresh_tokens definição

-- Drop table

-- DROP TABLE public.refresh_tokens;

CREATE TABLE public.refresh_tokens (
	id int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"token" varchar(500) NOT NULL,
	usuario_id int4 NOT NULL,
	data_expiracao timestamptz NOT NULL,
	revogado bool DEFAULT false NOT NULL,
	data_revogacao timestamptz NULL,
	endereco_ip varchar(45) NULL,
	user_agent varchar(1000) NULL,
	data_criacao timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	data_atualizacao timestamptz NULL,
	CONSTRAINT "PK_refresh_tokens" PRIMARY KEY (id)
);
CREATE INDEX "IX_RefreshTokens_DataCriacao" ON public.refresh_tokens USING btree (data_criacao);
CREATE INDEX ix_refresh_tokens_data_expiracao ON public.refresh_tokens USING btree (data_expiracao);
CREATE UNIQUE INDEX ix_refresh_tokens_token ON public.refresh_tokens USING btree (token);
CREATE INDEX ix_refresh_tokens_usuario_id ON public.refresh_tokens USING btree (usuario_id);
CREATE INDEX ix_refresh_tokens_usuario_valido ON public.refresh_tokens USING btree (usuario_id, revogado, data_expiracao);


-- public.usuarios definição

-- Drop table

-- DROP TABLE public.usuarios;

CREATE TABLE public.usuarios (
	id int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	nome varchar(200) NOT NULL,
	email varchar(255) NOT NULL,
	celular varchar(20) NULL,
	cpf varchar(11) NULL,
	senha_hash varchar(255) NULL,
	ativo bool DEFAULT true NOT NULL,
	ultimo_login timestamptz NULL,
	logo_url varchar(500) NULL,
	data_criacao timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	data_atualizacao timestamptz NULL,
	CONSTRAINT "PK_usuarios" PRIMARY KEY (id)
);
CREATE INDEX "IX_Usuarios_DataCriacao" ON public.usuarios USING btree (data_criacao);
CREATE INDEX ix_usuarios_ativo ON public.usuarios USING btree (ativo);
CREATE UNIQUE INDEX ix_usuarios_cpf ON public.usuarios USING btree (cpf) WHERE (cpf IS NOT NULL);
CREATE UNIQUE INDEX ix_usuarios_email ON public.usuarios USING btree (email);


-- public."CatalogoItem" definição

-- Drop table

-- DROP TABLE public."CatalogoItem";

CREATE TABLE public."CatalogoItem" (
	"Id" int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"CatalogoId" int4 NOT NULL,
	"ProdutoId" int4 NOT NULL,
	"EstruturaPrecosJson" jsonb NOT NULL,
	"PrecoBase" numeric(18, 2) NULL,
	"Ativo" bool DEFAULT true NOT NULL,
	"DataCriacao" timestamp DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamp NULL,
	CONSTRAINT "PK_CatalogoItem" PRIMARY KEY ("Id"),
	CONSTRAINT "FK_CatalogoItem_Catalogo_CatalogoId" FOREIGN KEY ("CatalogoId") REFERENCES public."Catalogo"("Id") ON DELETE CASCADE
);
CREATE INDEX "IX_CatalogoItem_Ativo" ON public."CatalogoItem" USING btree ("Ativo");
CREATE INDEX "IX_CatalogoItem_CatalogoId" ON public."CatalogoItem" USING btree ("CatalogoId");
CREATE UNIQUE INDEX "IX_CatalogoItem_CatalogoProduto" ON public."CatalogoItem" USING btree ("CatalogoId", "ProdutoId");
CREATE INDEX "IX_CatalogoItem_ProdutoId" ON public."CatalogoItem" USING btree ("ProdutoId");
CREATE INDEX "IX_CatalogoItens_DataCriacao" ON public."CatalogoItem" USING btree ("DataCriacao");


-- public."Categoria" definição

-- Drop table

-- DROP TABLE public."Categoria";

CREATE TABLE public."Categoria" (
	"Id" int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"Nome" text NOT NULL,
	"Descricao" text NULL,
	"Tipo" int4 NOT NULL,
	"Ativo" bool NOT NULL,
	"CategoriaPaiId" int4 NULL,
	"Ordem" int4 NOT NULL,
	"DataCriacao" timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamptz NULL,
	CONSTRAINT "PK_Categoria" PRIMARY KEY ("Id"),
	CONSTRAINT "FK_Categoria_Categoria_CategoriaPaiId" FOREIGN KEY ("CategoriaPaiId") REFERENCES public."Categoria"("Id")
);
CREATE INDEX "IX_Categoria_CategoriaPaiId" ON public."Categoria" USING btree ("CategoriaPaiId");
CREATE INDEX "IX_Categoria_DataCriacao" ON public."Categoria" USING btree ("DataCriacao");


-- public."ComboCategoriaDesconto" definição

-- Drop table

-- DROP TABLE public."ComboCategoriaDesconto";

CREATE TABLE public."ComboCategoriaDesconto" (
	"Id" int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"ComboId" int4 NOT NULL,
	"CategoriaId" int4 NOT NULL,
	"PercentualDesconto" numeric(5, 2) NOT NULL,
	"ValorDescontoFixo" numeric(18, 4) NOT NULL,
	"DescontoPorHectare" numeric(18, 4) NOT NULL,
	"TipoDesconto" int4 NOT NULL,
	"HectareMinimo" numeric(18, 4) NOT NULL,
	"HectareMaximo" numeric(18, 4) NOT NULL,
	"Ativo" bool NOT NULL,
	"DataCriacao" timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamptz NULL,
	CONSTRAINT "PK_ComboCategoriaDesconto" PRIMARY KEY ("Id"),
	CONSTRAINT "FK_ComboCategoriaDesconto_Combo_ComboId" FOREIGN KEY ("ComboId") REFERENCES public."Combo"("Id") ON DELETE CASCADE
);
CREATE INDEX "IX_ComboCategoriaDesconto_Ativo" ON public."ComboCategoriaDesconto" USING btree ("Ativo");
CREATE INDEX "IX_ComboCategoriaDesconto_CategoriaId" ON public."ComboCategoriaDesconto" USING btree ("CategoriaId");
CREATE UNIQUE INDEX "IX_ComboCategoriaDesconto_ComboCategoria" ON public."ComboCategoriaDesconto" USING btree ("ComboId", "CategoriaId");
CREATE INDEX "IX_ComboCategoriaDesconto_ComboId" ON public."ComboCategoriaDesconto" USING btree ("ComboId");
CREATE INDEX "IX_ComboCategoriasDesconto_DataCriacao" ON public."ComboCategoriaDesconto" USING btree ("DataCriacao");


-- public."ComboItem" definição

-- Drop table

-- DROP TABLE public."ComboItem";

CREATE TABLE public."ComboItem" (
	"Id" int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"ComboId" int4 NOT NULL,
	"ProdutoId" int4 NOT NULL,
	"Quantidade" numeric(18, 4) NOT NULL,
	"PrecoUnitario" numeric(18, 4) NOT NULL,
	"PercentualDesconto" numeric(5, 2) NOT NULL,
	"ProdutoObrigatorio" bool NOT NULL,
	"Ordem" int4 NOT NULL,
	"DataCriacao" timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamptz NULL,
	CONSTRAINT "PK_ComboItem" PRIMARY KEY ("Id"),
	CONSTRAINT "FK_ComboItem_Combo_ComboId" FOREIGN KEY ("ComboId") REFERENCES public."Combo"("Id") ON DELETE CASCADE
);
CREATE INDEX "IX_ComboItem_ComboId" ON public."ComboItem" USING btree ("ComboId");
CREATE INDEX "IX_ComboItem_ComboOrdem" ON public."ComboItem" USING btree ("ComboId", "Ordem");
CREATE INDEX "IX_ComboItem_ProdutoId" ON public."ComboItem" USING btree ("ProdutoId");
CREATE INDEX "IX_ComboItens_DataCriacao" ON public."ComboItem" USING btree ("DataCriacao");


-- public."ComboLocalRecebimento" definição

-- Drop table

-- DROP TABLE public."ComboLocalRecebimento";

CREATE TABLE public."ComboLocalRecebimento" (
	"Id" int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"ComboId" int4 NOT NULL,
	"PontoDistribuicaoId" int4 NOT NULL,
	"PrecoAdicional" numeric(18, 4) NOT NULL,
	"PercentualDesconto" numeric(5, 2) NOT NULL,
	"LocalPadrao" bool NOT NULL,
	"Observacoes" varchar(500) NULL,
	"DataCriacao" timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamptz NULL,
	CONSTRAINT "PK_ComboLocalRecebimento" PRIMARY KEY ("Id"),
	CONSTRAINT "FK_ComboLocalRecebimento_Combo_ComboId" FOREIGN KEY ("ComboId") REFERENCES public."Combo"("Id") ON DELETE CASCADE
);
CREATE INDEX "IX_ComboLocaisRecebimento_DataCriacao" ON public."ComboLocalRecebimento" USING btree ("DataCriacao");
CREATE INDEX "IX_ComboLocalRecebimento_ComboId" ON public."ComboLocalRecebimento" USING btree ("ComboId");
CREATE UNIQUE INDEX "IX_ComboLocalRecebimento_ComboPonto" ON public."ComboLocalRecebimento" USING btree ("ComboId", "PontoDistribuicaoId");
CREATE INDEX "IX_ComboLocalRecebimento_PontoDistribuicaoId" ON public."ComboLocalRecebimento" USING btree ("PontoDistribuicaoId");


-- public."Embalagens" definição

-- Drop table

-- DROP TABLE public."Embalagens";

CREATE TABLE public."Embalagens" (
	"Id" serial4 NOT NULL,
	"Nome" varchar(100) NOT NULL,
	"Descricao" varchar(500) NULL,
	"UnidadeMedidaId" int4 NOT NULL,
	"Ativo" bool DEFAULT true NOT NULL,
	"DataCriacao" timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamptz NULL,
	CONSTRAINT "Embalagens_pkey" PRIMARY KEY ("Id"),
	CONSTRAINT "FK_Embalagens_UnidadesMedida_UnidadeMedidaId" FOREIGN KEY ("UnidadeMedidaId") REFERENCES public."UnidadesMedida"("Id") ON DELETE RESTRICT
);
CREATE INDEX "IX_Embalagens_DataCriacao" ON public."Embalagens" USING btree ("DataCriacao");
CREATE INDEX "IX_Embalagens_Nome" ON public."Embalagens" USING btree ("Nome");
CREATE UNIQUE INDEX "IX_Embalagens_Nome_UnidadeMedidaId_Unique" ON public."Embalagens" USING btree ("Nome", "UnidadeMedidaId");
CREATE INDEX "IX_Embalagens_UnidadeMedidaId" ON public."Embalagens" USING btree ("UnidadeMedidaId");


-- public."Produto" definição

-- Drop table

-- DROP TABLE public."Produto";

CREATE TABLE public."Produto" (
	"Id" int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"Nome" varchar(200) NOT NULL,
	"Descricao" varchar(1000) NULL,
	"Codigo" varchar(50) NOT NULL,
	"Marca" varchar(100) NULL,
	"Tipo" int4 NOT NULL,
	"Status" int4 NOT NULL,
	"TipoCalculoPeso" int4 NOT NULL,
	"ProdutoRestrito" bool NOT NULL,
	"ObservacoesRestricao" varchar(500) NULL,
	"CategoriaId" int4 NOT NULL,
	"FornecedorId" int4 NOT NULL,
	"ProdutoPaiId" int4 NULL,
	"DadosAdicionais" jsonb NULL,
	"DataCriacao" timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamptz NULL,
	"PesoEmbalagem" numeric(10, 3) DEFAULT 0 NOT NULL,
	"Pms" numeric(10, 3) NULL,
	"QuantidadeMinima" numeric(10, 3) DEFAULT 1 NOT NULL,
	"Embalagem" varchar(100) DEFAULT ''::character varying NOT NULL,
	"FaixaDensidadeInicial" numeric(10, 3) NULL,
	"FaixaDensidadeFinal" numeric(10, 3) NULL,
	"UnidadeMedidaId" int4 DEFAULT 1 NOT NULL,
	"AtividadeAgropecuariaId" int4 NULL,
	"EmbalagemId" int4 NULL,
	CONSTRAINT "PK_Produto" PRIMARY KEY ("Id"),
	CONSTRAINT "FK_Produto_AtividadeAgropecuaria_AtividadeAgropecuariaId" FOREIGN KEY ("AtividadeAgropecuariaId") REFERENCES public."AtividadesAgropecuarias"("Id") ON DELETE RESTRICT,
	CONSTRAINT "FK_Produto_Categoria_CategoriaId" FOREIGN KEY ("CategoriaId") REFERENCES public."Categoria"("Id") ON DELETE RESTRICT,
	CONSTRAINT "FK_Produto_Embalagem_EmbalagemId" FOREIGN KEY ("EmbalagemId") REFERENCES public."Embalagens"("Id") ON DELETE RESTRICT,
	CONSTRAINT "FK_Produto_Produto_ProdutoPaiId" FOREIGN KEY ("ProdutoPaiId") REFERENCES public."Produto"("Id"),
	CONSTRAINT "FK_Produto_UnidadeMedida_UnidadeMedidaId" FOREIGN KEY ("UnidadeMedidaId") REFERENCES public."UnidadesMedida"("Id") ON DELETE RESTRICT
);
CREATE INDEX "IX_Produto_CategoriaId" ON public."Produto" USING btree ("CategoriaId");
CREATE INDEX "IX_Produto_DataCriacao" ON public."Produto" USING btree ("DataCriacao");
CREATE INDEX "IX_Produto_ProdutoPaiId" ON public."Produto" USING btree ("ProdutoPaiId");
CREATE INDEX "IX_Produto_UnidadesMedidaId" ON public."Produto" USING btree ("UnidadeMedidaId");


-- public."ProdutoCultura" definição

-- Drop table

-- DROP TABLE public."ProdutoCultura";

CREATE TABLE public."ProdutoCultura" (
	"Id" int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"ProdutoId" int4 NOT NULL,
	"CulturaId" int4 NOT NULL,
	"Ativo" bool NOT NULL,
	"Observacoes" text NULL,
	"DataCriacao" timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamptz NULL,
	CONSTRAINT "PK_ProdutoCultura" PRIMARY KEY ("Id"),
	CONSTRAINT "FK_ProdutoCultura_Produto_ProdutoId" FOREIGN KEY ("ProdutoId") REFERENCES public."Produto"("Id") ON DELETE CASCADE
);
CREATE INDEX "IX_ProdutoCultura_DataCriacao" ON public."ProdutoCultura" USING btree ("DataCriacao");
CREATE INDEX "IX_ProdutoCultura_ProdutoId" ON public."ProdutoCultura" USING btree ("ProdutoId");


-- public."Produtor" definição

-- Drop table

-- DROP TABLE public."Produtor";

CREATE TABLE public."Produtor" (
	"Id" int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"Nome" varchar(200) NOT NULL,
	"Cpf" varchar(11) NULL,
	"Cnpj" varchar(14) NULL,
	"InscricaoEstadual" varchar(50) NULL,
	"TipoAtividade" varchar(100) NULL,
	"AreaPlantio" numeric(18, 4) NOT NULL,
	"DataAutorizacao" timestamptz NOT NULL,
	"Status" int4 NOT NULL,
	"RetornosApiCheckProdutor" jsonb NULL,
	"UsuarioAutorizacaoId" int4 NULL,
	"Culturas" jsonb NOT NULL,
	"DataCriacao" timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamptz NULL,
	"Telefone1" varchar(20) NULL,
	"Telefone2" varchar(20) NULL,
	"Telefone3" varchar(20) NULL,
	"Email" varchar(100) NULL,
	CONSTRAINT "PK_Produtor" PRIMARY KEY ("Id"),
	CONSTRAINT "FK_Produtor_usuarios_UsuarioAutorizacaoId" FOREIGN KEY ("UsuarioAutorizacaoId") REFERENCES public.usuarios(id) ON DELETE SET NULL
);
CREATE INDEX "IX_Produtor_AreaPlantio" ON public."Produtor" USING btree ("AreaPlantio");
CREATE UNIQUE INDEX "IX_Produtor_Cnpj" ON public."Produtor" USING btree ("Cnpj") WHERE ("Cnpj" IS NOT NULL);
CREATE UNIQUE INDEX "IX_Produtor_Cpf" ON public."Produtor" USING btree ("Cpf") WHERE ("Cpf" IS NOT NULL);
CREATE INDEX "IX_Produtor_DataCriacao" ON public."Produtor" USING btree ("DataCriacao");
CREATE INDEX "IX_Produtor_Status" ON public."Produtor" USING btree ("Status");
CREATE INDEX "IX_Produtor_UsuarioAutorizacaoId" ON public."Produtor" USING btree ("UsuarioAutorizacaoId");


-- public."Proposta" definição

-- Drop table

-- DROP TABLE public."Proposta";

CREATE TABLE public."Proposta" (
	"Id" int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"PedidoId" int4 NOT NULL,
	"AcaoComprador" int4 NULL,
	"Observacao" varchar(1024) NULL,
	"UsuarioProdutorId" int4 NULL,
	"UsuarioFornecedorId" int4 NULL,
	"DataCriacao" timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamptz NULL,
	CONSTRAINT "PK_Proposta" PRIMARY KEY ("Id"),
	CONSTRAINT "FK_Proposta_Pedido_PedidoId" FOREIGN KEY ("PedidoId") REFERENCES public."Pedido"("Id") ON DELETE CASCADE
);
CREATE INDEX "IX_Proposta_DataCriacao" ON public."Proposta" USING btree ("DataCriacao");
CREATE INDEX "IX_Proposta_PedidoId" ON public."Proposta" USING btree ("PedidoId");
CREATE INDEX "IX_Proposta_UsuarioFornecedorId" ON public."Proposta" USING btree ("UsuarioFornecedorId");
CREATE INDEX "IX_Proposta_UsuarioProdutorId" ON public."Proposta" USING btree ("UsuarioProdutorId");


-- public."PropriedadeCultura" definição

-- Drop table

-- DROP TABLE public."PropriedadeCultura";

CREATE TABLE public."PropriedadeCultura" (
	"Id" int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"PropriedadeId" int4 NOT NULL,
	"CulturaId" int4 NOT NULL,
	"Area" numeric(18, 4) NOT NULL,
	"SafraId" int4 NULL,
	"DataPlantio" timestamptz NULL,
	"DataColheitaPrevista" timestamptz NULL,
	"Observacoes" varchar(1000) NULL,
	"DataCriacao" timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamptz NULL,
	CONSTRAINT "PK_PropriedadeCultura" PRIMARY KEY ("Id"),
	CONSTRAINT "FK_PropriedadeCultura_Propriedade_PropriedadeId" FOREIGN KEY ("PropriedadeId") REFERENCES public."Propriedade"("Id") ON DELETE CASCADE
);
CREATE INDEX "IX_PropriedadeCultura_CulturaId" ON public."PropriedadeCultura" USING btree ("CulturaId");
CREATE INDEX "IX_PropriedadeCultura_PeriodoPlantio" ON public."PropriedadeCultura" USING btree ("DataPlantio", "DataColheitaPrevista");
CREATE INDEX "IX_PropriedadeCultura_PropriedadeId" ON public."PropriedadeCultura" USING btree ("PropriedadeId");
CREATE UNIQUE INDEX "IX_PropriedadeCultura_PropriedadeId_CulturaId" ON public."PropriedadeCultura" USING btree ("PropriedadeId", "CulturaId");
CREATE INDEX "IX_PropriedadeCultura_SafraId" ON public."PropriedadeCultura" USING btree ("SafraId");
CREATE INDEX "IX_PropriedadeCulturas_DataCriacao" ON public."PropriedadeCultura" USING btree ("DataCriacao");


-- public."Talhao" definição

-- Drop table

-- DROP TABLE public."Talhao";

CREATE TABLE public."Talhao" (
	"Id" int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"Nome" varchar(200) NOT NULL,
	"Area" numeric(18, 4) NOT NULL,
	"PropriedadeId" int4 NOT NULL,
	"DataCriacao" timestamp DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamp NULL,
	CONSTRAINT "PK_Talhao" PRIMARY KEY ("Id"),
	CONSTRAINT "FK_Talhao_Propriedade_PropriedadeId" FOREIGN KEY ("PropriedadeId") REFERENCES public."Propriedade"("Id") ON DELETE CASCADE
);
CREATE INDEX "IX_Talhao_Area" ON public."Talhao" USING btree ("Area");
CREATE INDEX "IX_Talhao_DataCriacao" ON public."Talhao" USING btree ("DataCriacao");
CREATE INDEX "IX_Talhao_PropriedadeId" ON public."Talhao" USING btree ("PropriedadeId");


-- public."UsuarioProdutor" definição

-- Drop table

-- DROP TABLE public."UsuarioProdutor";

CREATE TABLE public."UsuarioProdutor" (
	"Id" int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"UsuarioId" int4 NOT NULL,
	"ProdutorId" int4 NOT NULL,
	"EhProprietario" bool NOT NULL,
	"Ativo" bool NOT NULL,
	"DataCriacao" timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamptz NULL,
	CONSTRAINT "PK_UsuarioProdutor" PRIMARY KEY ("Id"),
	CONSTRAINT "FK_UsuarioProdutor_Produtor_ProdutorId" FOREIGN KEY ("ProdutorId") REFERENCES public."Produtor"("Id") ON DELETE CASCADE,
	CONSTRAINT "FK_UsuarioProdutor_usuarios_UsuarioId" FOREIGN KEY ("UsuarioId") REFERENCES public.usuarios(id) ON DELETE CASCADE
);
CREATE INDEX "IX_UsuarioProdutor_Ativo" ON public."UsuarioProdutor" USING btree ("Ativo");
CREATE INDEX "IX_UsuarioProdutor_EhProprietario" ON public."UsuarioProdutor" USING btree ("EhProprietario");
CREATE INDEX "IX_UsuarioProdutor_ProdutorId" ON public."UsuarioProdutor" USING btree ("ProdutorId");
CREATE INDEX "IX_UsuarioProdutor_UsuarioId" ON public."UsuarioProdutor" USING btree ("UsuarioId");
CREATE UNIQUE INDEX "IX_UsuarioProdutor_UsuarioId_ProdutorId" ON public."UsuarioProdutor" USING btree ("UsuarioId", "ProdutorId");
CREATE INDEX "IX_UsuariosProdutores_DataCriacao" ON public."UsuarioProdutor" USING btree ("DataCriacao");


-- public.cultura_forma_pagamento definição

-- Drop table

-- DROP TABLE public.cultura_forma_pagamento;

CREATE TABLE public.cultura_forma_pagamento (
	id int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	fornecedor_id int4 NOT NULL,
	cultura_id int4 NOT NULL,
	forma_pagamento_id int4 NOT NULL,
	ativo bool DEFAULT true NOT NULL,
	data_criacao timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	data_atualizacao timestamptz NULL,
	CONSTRAINT "PK_cultura_forma_pagamento" PRIMARY KEY (id),
	CONSTRAINT "FK_cultura_forma_pagamento_forma_pagamento_forma_pagamento_id" FOREIGN KEY (forma_pagamento_id) REFERENCES public.forma_pagamento(id) ON DELETE RESTRICT
);
CREATE INDEX "IX_CulturaFormasPagamento_DataCriacao" ON public.cultura_forma_pagamento USING btree (data_criacao);
CREATE INDEX ix_cultura_forma_pagamento_ativo ON public.cultura_forma_pagamento USING btree (ativo);
CREATE INDEX ix_cultura_forma_pagamento_cultura_id ON public.cultura_forma_pagamento USING btree (cultura_id);
CREATE INDEX ix_cultura_forma_pagamento_forma_pagamento_id ON public.cultura_forma_pagamento USING btree (forma_pagamento_id);
CREATE INDEX ix_cultura_forma_pagamento_fornecedor_id ON public.cultura_forma_pagamento USING btree (fornecedor_id);
CREATE UNIQUE INDEX ix_cultura_forma_pagamento_unique ON public.cultura_forma_pagamento USING btree (fornecedor_id, cultura_id, forma_pagamento_id);


-- public.municipios definição

-- Drop table

-- DROP TABLE public.municipios;

CREATE TABLE public.municipios (
	id int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	nome varchar(150) NOT NULL,
	codigo_ibge int4 NOT NULL,
	cep_principal varchar(8) NULL,
	latitude float8 NULL,
	longitude float8 NULL,
	estado_id int4 NOT NULL,
	data_criacao timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	data_atualizacao timestamptz NULL,
	CONSTRAINT "PK_municipios" PRIMARY KEY (id),
	CONSTRAINT "FK_municipios_estados_estado_id" FOREIGN KEY (estado_id) REFERENCES public.estados(id) ON DELETE RESTRICT
);
CREATE INDEX "IX_Municipios_DataCriacao" ON public.municipios USING btree (data_criacao);
CREATE INDEX "IX_municipios_cep_principal" ON public.municipios USING btree (cep_principal);
CREATE UNIQUE INDEX "IX_municipios_codigo_ibge" ON public.municipios USING btree (codigo_ibge);
CREATE INDEX "IX_municipios_estado_id" ON public.municipios USING btree (estado_id);
CREATE INDEX "IX_municipios_nome" ON public.municipios USING btree (nome);


-- public.usuario_roles definição

-- Drop table

-- DROP TABLE public.usuario_roles;

CREATE TABLE public.usuario_roles (
	id int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	usuario_id int4 NOT NULL,
	"role" int4 NOT NULL,
	data_atribuicao timestamptz NOT NULL,
	data_criacao timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	data_atualizacao timestamptz NULL,
	CONSTRAINT "PK_usuario_roles" PRIMARY KEY (id),
	CONSTRAINT "FK_usuario_roles_usuarios_usuario_id" FOREIGN KEY (usuario_id) REFERENCES public.usuarios(id) ON DELETE CASCADE
);
CREATE INDEX "IX_UsuarioRoles_DataCriacao" ON public.usuario_roles USING btree (data_criacao);
CREATE INDEX ix_usuario_roles_role ON public.usuario_roles USING btree (role);
CREATE INDEX ix_usuario_roles_usuario_id ON public.usuario_roles USING btree (usuario_id);
CREATE UNIQUE INDEX ix_usuario_roles_usuario_role_unique ON public.usuario_roles USING btree (usuario_id, role);


-- public."Fornecedor" definição

-- Drop table

-- DROP TABLE public."Fornecedor";

CREATE TABLE public."Fornecedor" (
	"Id" int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"Nome" varchar(200) NOT NULL,
	"Cnpj" varchar(14) NOT NULL,
	"InscricaoEstadual" varchar(50) NULL,
	"Logradouro" varchar(500) NULL,
	"Telefone" varchar(20) NULL,
	"Email" varchar(100) NULL,
	"LogoUrl" varchar(500) NULL,
	"MoedaPadrao" int4 NOT NULL,
	"PedidoMinimo" numeric(18, 2) NULL,
	"TokenLincros" varchar(100) NULL,
	"Ativo" bool NOT NULL,
	"DadosAdicionais" jsonb NULL,
	"DataCriacao" timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamptz NULL,
	"Cep" varchar(10) NULL,
	"Complemento" varchar(200) NULL,
	"Latitude" numeric(10, 8) NULL,
	"Longitude" numeric(11, 8) NULL,
	"UfId" int4 NULL,
	"MunicipioId" int4 NULL,
	CONSTRAINT "PK_Fornecedor" PRIMARY KEY ("Id"),
	CONSTRAINT "FK_Fornecedor_Estados_UfId" FOREIGN KEY ("UfId") REFERENCES public.estados(id),
	CONSTRAINT "FK_Fornecedor_Municipios_MunicipioId" FOREIGN KEY ("MunicipioId") REFERENCES public.municipios(id)
);
CREATE INDEX "IX_Fornecedor_Ativo" ON public."Fornecedor" USING btree ("Ativo");
CREATE UNIQUE INDEX "IX_Fornecedor_Cnpj" ON public."Fornecedor" USING btree ("Cnpj");
CREATE INDEX "IX_Fornecedor_DataCriacao" ON public."Fornecedor" USING btree ("DataCriacao");
CREATE INDEX "IX_Fornecedor_Email" ON public."Fornecedor" USING btree ("Email") WHERE ("Email" IS NOT NULL);
CREATE INDEX "IX_Fornecedor_MoedaPadrao" ON public."Fornecedor" USING btree ("MoedaPadrao");
CREATE INDEX "IX_Fornecedor_Nome" ON public."Fornecedor" USING btree ("Nome");


-- public."PedidoItem" definição

-- Drop table

-- DROP TABLE public."PedidoItem";

CREATE TABLE public."PedidoItem" (
	"Id" int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"PedidoId" int4 NOT NULL,
	"ProdutoId" int4 NOT NULL,
	"Quantidade" numeric(18, 4) NOT NULL,
	"PrecoUnitario" numeric(18, 4) NOT NULL,
	"ValorTotal" numeric(18, 4) NOT NULL,
	"PercentualDesconto" numeric(5, 2) NOT NULL,
	"ValorDesconto" numeric(18, 4) NOT NULL,
	"ValorFinal" numeric(18, 4) NOT NULL,
	"DadosAdicionais" jsonb NULL,
	"Observacoes" varchar(1000) NULL,
	"DataCriacao" timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamptz NULL,
	CONSTRAINT "PK_PedidoItem" PRIMARY KEY ("Id"),
	CONSTRAINT "FK_PedidoItem_Pedido_PedidoId" FOREIGN KEY ("PedidoId") REFERENCES public."Pedido"("Id") ON DELETE CASCADE,
	CONSTRAINT "FK_PedidoItem_Produto_ProdutoId" FOREIGN KEY ("ProdutoId") REFERENCES public."Produto"("Id") ON DELETE CASCADE
);
CREATE INDEX "IX_PedidoItem_PedidoId" ON public."PedidoItem" USING btree ("PedidoId");
CREATE INDEX "IX_PedidoItem_ProdutoId" ON public."PedidoItem" USING btree ("ProdutoId");
CREATE INDEX "IX_PedidoItem_ValorFinal" ON public."PedidoItem" USING btree ("ValorFinal");
CREATE INDEX "IX_PedidoItens_DataCriacao" ON public."PedidoItem" USING btree ("DataCriacao");


-- public."PedidoItemTransporte" definição

-- Drop table

-- DROP TABLE public."PedidoItemTransporte";

CREATE TABLE public."PedidoItemTransporte" (
	"Id" int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"PedidoItemId" int4 NOT NULL,
	"Quantidade" numeric(18, 4) NOT NULL,
	"DataAgendamento" timestamptz NULL,
	"ValorFrete" numeric(18, 4) NOT NULL,
	"PesoTotal" numeric(18, 4) NULL,
	"VolumeTotal" numeric(18, 4) NULL,
	"EnderecoOrigem" varchar(500) NULL,
	"EnderecoDestino" varchar(500) NULL,
	"InformacoesTransporte" jsonb NULL,
	"Observacoes" varchar(1000) NULL,
	"PedidoItemId1" int4 NULL,
	"DataCriacao" timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamptz NULL,
	CONSTRAINT "PK_PedidoItemTransporte" PRIMARY KEY ("Id"),
	CONSTRAINT "FK_PedidoItemTransporte_PedidoItem_PedidoItemId" FOREIGN KEY ("PedidoItemId") REFERENCES public."PedidoItem"("Id") ON DELETE CASCADE,
	CONSTRAINT "FK_PedidoItemTransporte_PedidoItem_PedidoItemId1" FOREIGN KEY ("PedidoItemId1") REFERENCES public."PedidoItem"("Id")
);
CREATE INDEX "IX_PedidoItemTransporte_DataAgendamento" ON public."PedidoItemTransporte" USING btree ("DataAgendamento");
CREATE INDEX "IX_PedidoItemTransporte_PedidoItemId" ON public."PedidoItemTransporte" USING btree ("PedidoItemId");
CREATE INDEX "IX_PedidoItemTransporte_PedidoItemId1" ON public."PedidoItemTransporte" USING btree ("PedidoItemId1");
CREATE INDEX "IX_PedidoItemTransporte_ValorFrete" ON public."PedidoItemTransporte" USING btree ("ValorFrete");
CREATE INDEX "IX_PedidoItensTransporte_DataCriacao" ON public."PedidoItemTransporte" USING btree ("DataCriacao");


-- public."PontoDistribuicao" definição

-- Drop table

-- DROP TABLE public."PontoDistribuicao";

CREATE TABLE public."PontoDistribuicao" (
	"Id" int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"Nome" varchar(200) NOT NULL,
	"Endereco" varchar(500) NULL,
	"Cidade" varchar(100) NULL,
	"Estado" varchar(2) NULL,
	"Cep" varchar(10) NULL,
	"Latitude" numeric(10, 8) NULL,
	"Longitude" numeric(11, 8) NULL,
	"FornecedorId" int4 NOT NULL,
	"Ativo" bool DEFAULT true NOT NULL,
	"DataCriacao" timestamp DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamp NULL,
	CONSTRAINT "PK_PontoDistribuicao" PRIMARY KEY ("Id"),
	CONSTRAINT "FK_PontoDistribuicao_Fornecedor_FornecedorId" FOREIGN KEY ("FornecedorId") REFERENCES public."Fornecedor"("Id") ON DELETE CASCADE
);
CREATE INDEX "IX_PontoDistribuicao_Ativo" ON public."PontoDistribuicao" USING btree ("Ativo");
CREATE INDEX "IX_PontoDistribuicao_Cidade" ON public."PontoDistribuicao" USING btree ("Cidade");
CREATE INDEX "IX_PontoDistribuicao_DataCriacao" ON public."PontoDistribuicao" USING btree ("DataCriacao");
CREATE INDEX "IX_PontoDistribuicao_Estado" ON public."PontoDistribuicao" USING btree ("Estado");
CREATE INDEX "IX_PontoDistribuicao_FornecedorId" ON public."PontoDistribuicao" USING btree ("FornecedorId");


-- public."UsuarioFornecedor" definição

-- Drop table

-- DROP TABLE public."UsuarioFornecedor";

CREATE TABLE public."UsuarioFornecedor" (
	"Id" int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"UsuarioId" int4 NOT NULL,
	"FornecedorId" int4 NOT NULL,
	"Role" int4 NOT NULL,
	"Ativo" bool NOT NULL,
	"DataInicio" timestamptz NOT NULL,
	"DataFim" timestamptz NULL,
	"DataCriacao" timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamptz NULL,
	CONSTRAINT "PK_UsuarioFornecedor" PRIMARY KEY ("Id"),
	CONSTRAINT "FK_UsuarioFornecedor_Fornecedor_FornecedorId" FOREIGN KEY ("FornecedorId") REFERENCES public."Fornecedor"("Id") ON DELETE CASCADE,
	CONSTRAINT "FK_UsuarioFornecedor_usuarios_UsuarioId" FOREIGN KEY ("UsuarioId") REFERENCES public.usuarios(id) ON DELETE CASCADE
);
CREATE INDEX "IX_UsuarioFornecedor_Ativo" ON public."UsuarioFornecedor" USING btree ("Ativo");
CREATE INDEX "IX_UsuarioFornecedor_DataCriacao" ON public."UsuarioFornecedor" USING btree ("DataCriacao");
CREATE INDEX "IX_UsuarioFornecedor_DataInicio" ON public."UsuarioFornecedor" USING btree ("DataInicio");
CREATE INDEX "IX_UsuarioFornecedor_FornecedorId" ON public."UsuarioFornecedor" USING btree ("FornecedorId");
CREATE INDEX "IX_UsuarioFornecedor_Role" ON public."UsuarioFornecedor" USING btree ("Role");
CREATE INDEX "IX_UsuarioFornecedor_UsuarioId" ON public."UsuarioFornecedor" USING btree ("UsuarioId");
CREATE UNIQUE INDEX "IX_UsuarioFornecedor_Usuario_Fornecedor" ON public."UsuarioFornecedor" USING btree ("UsuarioId", "FornecedorId");


-- public."UsuarioFornecedorTerritorio" definição

-- Drop table

-- DROP TABLE public."UsuarioFornecedorTerritorio";

CREATE TABLE public."UsuarioFornecedorTerritorio" (
	"Id" int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"UsuarioFornecedorId" int4 NOT NULL,
	"Estados" jsonb NOT NULL,
	"Municipios" jsonb NULL,
	"TerritorioPadrao" bool NOT NULL,
	"Ativo" bool NOT NULL,
	"DataCriacao" timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	"DataAtualizacao" timestamptz NULL,
	CONSTRAINT "PK_UsuarioFornecedorTerritorio" PRIMARY KEY ("Id"),
	CONSTRAINT "FK_UsuarioFornecedorTerritorio_UsuarioFornecedor_UsuarioFornec~" FOREIGN KEY ("UsuarioFornecedorId") REFERENCES public."UsuarioFornecedor"("Id") ON DELETE CASCADE
);
CREATE INDEX "IX_UsuarioFornecedorTerritorio_Ativo" ON public."UsuarioFornecedorTerritorio" USING btree ("Ativo");
CREATE INDEX "IX_UsuarioFornecedorTerritorio_DataCriacao" ON public."UsuarioFornecedorTerritorio" USING btree ("DataCriacao");
CREATE INDEX "IX_UsuarioFornecedorTerritorio_Estados_GIN" ON public."UsuarioFornecedorTerritorio" USING gin ("Estados");
CREATE INDEX "IX_UsuarioFornecedorTerritorio_Municipios_GIN" ON public."UsuarioFornecedorTerritorio" USING gin ("Municipios") WHERE ("Municipios" IS NOT NULL);
CREATE INDEX "IX_UsuarioFornecedorTerritorio_TerritorioPadrao" ON public."UsuarioFornecedorTerritorio" USING btree ("TerritorioPadrao");
CREATE INDEX "IX_UsuarioFornecedorTerritorio_UsuarioFornecedorId" ON public."UsuarioFornecedorTerritorio" USING btree ("UsuarioFornecedorId");


-- public.enderecos definição

-- Drop table

-- DROP TABLE public.enderecos;

CREATE TABLE public.enderecos (
	id int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	cep varchar(8) NOT NULL,
	logradouro varchar(200) NOT NULL,
	numero varchar(20) NULL,
	complemento varchar(100) NULL,
	bairro varchar(100) NOT NULL,
	latitude float8 NULL,
	longitude float8 NULL,
	municipio_id int4 NOT NULL,
	estado_id int4 NOT NULL,
	data_criacao timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL,
	data_atualizacao timestamptz NULL,
	CONSTRAINT "PK_enderecos" PRIMARY KEY (id),
	CONSTRAINT "FK_enderecos_estados_estado_id" FOREIGN KEY (estado_id) REFERENCES public.estados(id) ON DELETE RESTRICT,
	CONSTRAINT "FK_enderecos_municipios_municipio_id" FOREIGN KEY (municipio_id) REFERENCES public.municipios(id) ON DELETE RESTRICT
);
CREATE INDEX "IX_Enderecos_DataCriacao" ON public.enderecos USING btree (data_criacao);
CREATE INDEX "IX_enderecos_bairro" ON public.enderecos USING btree (bairro);
CREATE INDEX "IX_enderecos_cep" ON public.enderecos USING btree (cep);
CREATE INDEX "IX_enderecos_estado_id" ON public.enderecos USING btree (estado_id);
CREATE INDEX "IX_enderecos_logradouro" ON public.enderecos USING btree (logradouro);
CREATE INDEX "IX_enderecos_municipio_id" ON public.enderecos USING btree (municipio_id);
CREATE INDEX "IX_enderecos_unique_address" ON public.enderecos USING btree (cep, logradouro, numero, municipio_id);